# ë¶„ì„ ì›Œì»¤ ì•„í‚¤í…ì²˜ ì„¤ê³„

## ğŸ— ì›Œì»¤ ì‹œìŠ¤í…œ êµ¬ì¡°

### ì›Œì»¤ ì»´í¬ë„ŒíŠ¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Analysis Worker                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Job Manager â”‚ â”‚ Scheduler   â”‚ â”‚    Analysis Engines     â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Recommendation     â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Engine             â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Support Level      â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Calculator         â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Market Status      â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â”‚ Analyzer           â”‚ â”‚ â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DB Writer   â”‚ â”‚ Cache       â”‚ â”‚    Market Data          â”‚ â”‚
â”‚  â”‚             â”‚ â”‚ Manager     â”‚ â”‚    Service              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ì›Œì»¤ ìŠ¤ì¼€ì¤„ë§ ì „ëµ

### 1. ì‘ì—… ìš°ì„ ìˆœìœ„
```python
JOB_PRIORITY = {
    'market_status': 1,          # ê°€ì¥ ë†’ìŒ (ì‹œì¥ ì „ë°˜)
    'recommendations': 2,        # ë†’ìŒ (í•µì‹¬ ê¸°ëŠ¥)
    'support_levels': 3,         # ë³´í†µ (ìƒì„¸ ë¶„ì„)
    'cleanup': 4                 # ë‚®ìŒ (ìœ ì§€ë³´ìˆ˜)
}
```

### 2. ì‹¤í–‰ ì£¼ê¸°
```python
SCHEDULE = {
    'market_status': '*/2 * * * *',        # 2ë¶„ë§ˆë‹¤
    'recommendations': '*/5 * * * *',      # 5ë¶„ë§ˆë‹¤
    'support_levels': '*/15 * * * *',      # 15ë¶„ë§ˆë‹¤
    'cleanup': '0 */6 * * *'               # 6ì‹œê°„ë§ˆë‹¤
}
```

### 3. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
```python
RESOURCE_LIMITS = {
    'max_concurrent_jobs': 3,
    'memory_limit_mb': 2048,
    'timeout_seconds': 300,
    'retry_attempts': 3
}
```

## ğŸ”§ ì›Œì»¤ êµ¬í˜„ ê³„íš

### Phase 2-A: ê¸°ë³¸ ì›Œì»¤ í”„ë ˆì„ì›Œí¬
```python
# worker/base_worker.py
class BaseAnalysisWorker:
    def __init__(self):
        self.scheduler = AsyncIOScheduler()
        self.db_manager = DatabaseManager()
        self.cache_manager = CacheManager()
        
    async def start(self):
        """ì›Œì»¤ ì‹œì‘"""
        
    async def stop(self):
        """ì›Œì»¤ ì¤‘ì§€"""
        
    async def register_job(self, job_func, schedule, priority):
        """ì‘ì—… ë“±ë¡"""
```

### Phase 2-B: ë¶„ì„ ì—”ì§„ ë¶„ë¦¬
```python
# worker/engines/recommendation_engine.py
class RecommendationEngine:
    async def analyze(self) -> List[CoinRecommendation]:
        """ì½”ì¸ ì¶”ì²œ ë¶„ì„ ì‹¤í–‰"""
        
# worker/engines/support_level_engine.py  
class SupportLevelEngine:
    async def calculate(self, symbols: List[str]) -> Dict[str, SupportLevel]:
        """ì§€ì›/ì €í•­ì„  ê³„ì‚°"""
        
# worker/engines/market_status_engine.py
class MarketStatusEngine:
    async def analyze(self) -> MarketStatus:
        """ì‹œì¥ ìƒíƒœ ë¶„ì„"""
```

### Phase 2-C: ë°ì´í„° ì €ì¥ ê´€ë¦¬ì
```python
# worker/data_manager.py
class DataManager:
    async def save_recommendations(self, recommendations: List[CoinRecommendation]):
        """ì¶”ì²œ ë°ì´í„° ì €ì¥ (DB + Cache)"""
        
    async def save_support_levels(self, levels: Dict[str, SupportLevel]):
        """ì§€ì›ì„  ë°ì´í„° ì €ì¥"""
        
    async def save_market_status(self, status: MarketStatus):
        """ì‹œì¥ ìƒíƒœ ì €ì¥"""
```

## ğŸ› ì›Œì»¤ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜
```env
# ì›Œì»¤ ì„¤ì •
WORKER_ENABLED=true
WORKER_LOG_LEVEL=INFO
WORKER_MAX_WORKERS=3

# ìŠ¤ì¼€ì¤„ ì„¤ì •
RECOMMENDATIONS_INTERVAL=300    # 5ë¶„
SUPPORT_LEVELS_INTERVAL=900     # 15ë¶„
MARKET_STATUS_INTERVAL=120      # 2ë¶„

# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://user:pass@localhost:5432/dantaro
REDIS_URL=redis://localhost:6379/0

# ì™¸ë¶€ API
UPBIT_API_TIMEOUT=30
MAX_SYMBOLS_PER_BATCH=50
```

### ì„¤ì • íŒŒì¼
```python
# worker/config.py
class WorkerConfig:
    # ìŠ¤ì¼€ì¤„ë§
    recommendations_interval: int = 300
    support_levels_interval: int = 900
    market_status_interval: int = 120
    
    # ë¦¬ì†ŒìŠ¤
    max_concurrent_jobs: int = 3
    job_timeout: int = 300
    retry_attempts: int = 3
    
    # ë°ì´í„°
    max_symbols: int = 50
    cache_ttl: Dict[str, int] = {
        'recommendations': 300,
        'support_levels': 1800,
        'market_status': 300
    }
```

## ğŸš€ ë°°í¬ ë° ì‹¤í–‰

### 1. ë…ë¦½ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
```python
# worker/main.py
async def main():
    worker = AnalysisWorker()
    
    try:
        await worker.start()
        logger.info("Analysis worker started successfully")
        
        # ë¬´í•œ ì‹¤í–‰
        while True:
            await asyncio.sleep(1)
            
    except KeyboardInterrupt:
        logger.info("Shutting down worker...")
        await worker.stop()
```

### 2. systemd ì„œë¹„ìŠ¤
```ini
# /etc/systemd/system/dantaro-worker.service
[Unit]
Description=Dantaro Central Analysis Worker
After=network.target

[Service]
Type=simple
User=dantaro
WorkingDirectory=/opt/dantaro-central
ExecStart=/opt/dantaro-central/venv/bin/python worker/main.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 1. ì‘ì—… ìƒíƒœ ì¶”ì 
```python
# ì‘ì—… ì‹¤í–‰ ë¡œê·¸
JOB_LOG = {
    'job_id': 'uuid',
    'job_type': 'recommendations',
    'status': 'completed',
    'duration': 45.2,
    'symbols_processed': 50,
    'error': None,
    'timestamp': '2025-07-01T10:30:00Z'
}
```

### 2. í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
```python
# APIì— ì›Œì»¤ ìƒíƒœ í™•ì¸ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
@router.get("/worker/status")
async def get_worker_status():
    return {
        'worker_active': check_worker_heartbeat(),
        'last_jobs': get_recent_jobs(),
        'uptime': get_worker_uptime()
    }
```

---
**ë‹¤ìŒ ë‹¨ê³„**: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë° ëª¨ë¸ êµ¬í˜„
