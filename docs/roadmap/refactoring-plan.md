# Dantaro Central 아키텍처 리팩토링 계획

## 📋 프로젝트 개요
**목표**: 분석 기능과 API 서버를 분리하여 성능과 안정성을 개선

**현재 문제점**:
- API 서버 시작 시 100초+ 소요
- 첫 요청 시 긴 분석 시간 (100초)
- 분석 오류 시 전체 API 서비스 중단
- 확장성 부족

## 🎯 목표 아키텍처

### Before (현재)
```
┌─────────────────────────────────────┐
│        Dantaro Central API          │
│  ┌─────────────┐ ┌─────────────┐   │
│  │ API 엔드포인트│ │ 실시간 분석  │   │
│  │             │ │ (100초 소요) │   │
│  └─────────────┘ └─────────────┘   │
└─────────────────────────────────────┘
```

### After (목표)
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   API 서버      │    │   Redis/DB      │    │  분석 워커      │
│  (즉시 응답)    │◄──►│   (캐시/저장)   │◄──►│ (24시간 실행)   │
│   < 5초 시작    │    │                 │    │  독립 프로세스  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📅 작업 단계별 계획

### Phase 1: 데이터베이스 설계 및 설정
- [ ] PostgreSQL 스키마 설계
- [ ] Redis 캐시 구조 설계
- [ ] 데이터베이스 연결 설정

### Phase 2: 분석 워커 분리
- [ ] 기존 분석 코드를 독립 워커로 분리
- [ ] 워커 스케줄링 시스템 구현
- [ ] 데이터베이스 저장 로직 구현

### Phase 3: API 서버 경량화
- [ ] API 서버에서 분석 로직 제거
- [ ] 읽기 전용 엔드포인트로 변경
- [ ] 캐시 우선 로직 구현

### Phase 4: 배포 및 운영
- [ ] 워커 데몬화 (systemd/docker)
- [ ] 모니터링 및 로깅 설정
- [ ] 장애 복구 메커니즘

## 🛠 기술 스택

### 데이터베이스
- **PostgreSQL**: 분석 결과 영구 저장
- **Redis**: 실시간 캐시 및 세션

### 워커 시스템
- **독립 Python 프로세스**: 분석 워커
- **APScheduler**: 스케줄링
- **SQLAlchemy**: ORM

### API 서버
- **FastAPI**: 기존 유지 (경량화)
- **읽기 전용**: 분석 로직 제거

## 📊 예상 성능 개선

| 항목 | 현재 | 목표 | 개선율 |
|------|------|------|--------|
| 서버 시작 시간 | 100초+ | < 5초 | 95% 단축 |
| 첫 요청 응답 | 100초 | < 1초 | 99% 단축 |
| 캐시된 요청 | 0.01초 | 0.01초 | 동일 |
| 데이터 신선도 | 5분 | 실시간 | 지속 개선 |

## 🎯 다음 단계
1. 데이터베이스 스키마 설계 문서 작성
2. 워커 아키텍처 상세 설계
3. 마이그레이션 계획 수립

---
**작성일**: 2025-07-01  
**작성자**: Dantaro Central Team  
**버전**: v1.0
